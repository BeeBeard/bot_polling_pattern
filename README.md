# üöÄ Bot-Pattern

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî –±–æ—Ç —à–∞–±–ª–æ–Ω –Ω–∞ python, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π miniapp

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
üì¶ bot-pattern
 ‚î£ üìÇ app/                   # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞
 ‚îÉ ‚î£ üìÇ api/                 # API –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
 ‚îÉ ‚îÉ ‚î£ üìú bot_webhook.py     # Webhook –¥–ª—è–±–æ—Ç–∞
 ‚îÉ ‚îÉ ‚î£ üìú healthcheck.py     # –ü—Ä–æ–≤–µ—Ä–∫–∞ API
 ‚îÉ ‚îÉ ‚îó üìú miniapp.py         # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã miniapp
 ‚îÉ ‚î£ üìÇ bot/                 # –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞
 ‚îÉ ‚îÉ ‚î£ üìÇ content/           # –¢–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∏ –∏ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
 ‚îÉ ‚îÉ ‚î£ üìÇ middleware/        # Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
 ‚îÉ ‚îÉ ‚îó üìÇ routers/           # –†–æ—É—Ç–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
 ‚îÉ ‚îÉ   ‚î£ üìÇ channel/         # –†–æ—É—Ç–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤ –∫–∞–Ω–∞–ª–∞—Ö
 ‚îÉ ‚îÉ   ‚î£ üìÇ group/           # –†–æ—É—Ç–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –≤ –≥—Ä—É–ø–ø–∞—Ö –∏ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö
 ‚îÉ ‚îÉ   ‚îó üìÇ private/         # –†–æ—É—Ç–µ—Ä—ã –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å –±–æ—Ç–æ–º
 ‚îÉ ‚î£ üìÇ assistant/           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
 ‚îÉ ‚î£ üìÇ frontend/            # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ miniapp
 ‚îÉ ‚îÉ ‚î£ üìÇ static/            # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
 ‚îÉ ‚îÉ ‚îÉ ‚î£ üìÇ js/              # –°–∫—Ä–∏–ø—Ç—ã
 ‚îÉ ‚îÉ ‚îÉ ‚îó üìÇ style/           # –°—Ç–∏–ª–∏ 
 ‚îÉ ‚îÉ ‚îó üìÇ templates/         # HTML-—à–∞–±–ª–æ–Ω—ã
 ‚îÉ ‚îÉ   ‚îó üìÇ pages/           # –°—Ç—Ä–∞–Ω–∏—Ü—ã
 ‚îÉ ‚î£ üìÇ conn/                # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
 ‚îÉ ‚îÉ ‚î£ üìú engines.py         # –î–≤–∏–∂–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
 ‚îÉ ‚îÉ ‚î£ üìú sql.py             # SQL-–∑–∞–ø—Ä–æ—Å—ã
 ‚îÉ ‚îÉ ‚îó üìú tables.py          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
 ‚îÉ ‚î£ üìÇ models/              # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
 ‚îÉ ‚îó üìú config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
 ‚î£ üìú .env                   # –§–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
 ‚î£ üìú .env-example           # –ü—Ä–∏–º–µ–Ω .env —Ñ–∞–π–ª–∞
 ‚î£ üìú main.py                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
 ‚î£ üìú requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
 ‚îó üìú README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 0Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ BotFather

* –ó–∞–ø—É—Å—Ç–∏—Ç–µ @BotFather –∏ –ø—Ä–æ–ø–∏—à–∏—Ç–µ /mybots
* –ò–∑ —Å–ø–∏—Å–∫–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –±–æ—Ç
* –í—ã–±–µ—Ä–∏—Ç–µ: Bot Settings -> Configure Mini App -> Edit Mini App URL
* –£–∫–∞–∂–∏—Ç–µ URL –∏–∑ CONFIG.miniapp.path


### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)

```sh
pip install -r  requirements.txt
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –∏ —É–∫–∞–∂–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ):

```
HOST_IP=0.0.0.0
HOST_PORT=8000

DB_HOST=db
DB_PORT=3306
DB_NAME=bot_db
DB_USER=bot_user
DB_PASSWORD=bot_password
```

### 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –≤ Docker

```sh
docker-compose up -d --build
```

‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ —Å–æ–±–µ—Ä–µ—Ç—Å—è –æ–±—Ä–∞–∑.

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8009` .

## üõ† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ Docker

üìå **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**

```sh
docker-compose down
```

üìå **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**

```sh
docker-compose up -d --build
```

üìå **–õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ –±–æ—Ç–∞:**

```sh
docker logs -f bot-server
```

üìå **–ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MySQL:**

```sh
docker exec -it mysql-db mysql -u bot_user -p
```

## üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑–≤–Ω–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```
HOST: 127.0.0.1
PORT: 3306
USER: bot_user
PASSWORD: bot_password
DATABASE: bot_db
```

## üìù TODO

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD
- [ ] –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
